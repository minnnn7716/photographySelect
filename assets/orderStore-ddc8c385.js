import{l,p as h,q as g}from"./index-63aa369e.js";import{t as c}from"./toastStore-1d0482ec.js";const a=c(),m=l("orderStore",{state:()=>({orders:[],pagination:{},userOrders:[{user:{}}],isLoading:!1}),actions:{getOrders(){const e="https://vue3-course-api.hexschool.io/api/hexvuemm/orders?page=:page";this.isLoading=!0,h.get(e).then(t=>{this.orders=t.data.orders,this.pagination=t.data.pagination,this.isLoading=!1}).catch(t=>{t.request.status===404&&(this.isLoading=!1,a.pushMsg({style:"danger",title:"取得訂單失敗",content:"抱歉，出現系統問題，請聯絡我們！"}))})},getUserOrders(e){const t="https://vue3-course-api.hexschool.io/api/hexvuemm/orders?page=:page";this.isLoading=!0,h.get(t).then(s=>{this.orders=s.data.orders,this.filterOrder(e),this.isLoading=!1}).catch(s=>{s.request.status===404&&(this.isLoading=!1,a.pushMsg({style:"danger",title:"取得訂單失敗",content:"抱歉，出現系統問題，請聯絡我們！"}))})},searchOrder(e){this.orders.filter(s=>s.user.email===e).length?g.push(`/order/${e}`):a.pushMsg({style:"danger",title:"查無訂單"})},filterOrder(e){this.userOrders=this.orders.filter(t=>t.user.email===e)},payOrder(e,t){const s=`https://vue3-course-api.hexschool.io/api/hexvuemm/pay/${e}`;this.isLoading=!0,h.post(s).then(r=>{this.isLoading=!1,this.getUserOrders(t),r.data.success?a.pushMsg({style:"success",title:"付款成功"}):a.pushMsg({style:"danger",title:"付款失敗",content:r.data.message})}).catch(r=>{r.request.status===404&&(this.isLoading=!1,a.pushMsg({style:"danger",title:"付款失敗",content:"抱歉，出現系統問題，請聯絡我們！"}))})},dueDate(e){const t=new Date(e*1e3),s=t.getMonth(),r=t.getDate(),u=[1,3,5,7,8,10,12];let o=s+1,n=r,d=0;u.indexOf(o)===-1?d=30:d=31,r===d?(o+=1,n+=2):n+=1;const i=new Date;return i.setMonth(o-1),i.setDate(n),i.setHours(31),i.setMinutes(59),i.setSeconds(59),i},isCancel(e){const t=new Date().getTime();return this.dueDate(e).getTime()<t}},getters:{orderTotalPrice(){let e=0;return Object.keys(this.orders).length&&(e=this.orders.map(t=>t.total).reduce((t,s)=>t+s,0)),e},orderNum(){let e=0;return Object.keys(this.orders).length&&(e=this.orders.length),e}}});export{m as o};
