import{m as b,_ as I,r as g,o as c,c as r,a as e,f as i,g as U,n as u,i as w,s as C,h as L,x as V,b as v,d as $,t as h,F as x,e as y,w as F}from"./index-8558fa27.js";import{b as _,D,_ as N}from"./icon-trashcan-7a2a02a4.js";import{t as T}from"./toastStore-57ead6d4.js";import{m as j}from"./modalMixin-b8f36e48.js";import{_ as M}from"./icon-edit-2eb35b7f.js";import"./adminProductStore-143ddc0f.js";const S={data(){return{modal:"",tempNews:{tag:[]},tempTag:"",tempUrlImage:"",tempLocalImage:"",hasImageFile:!1,hasImageUrl:null}},props:{news:{type:Object,default(){return{}}}},mixins:[j],watch:{news(){this.tempNews=this.news,this.tempTag=this.news.tag.join(", "),this.news.id||this.$refs.updateNewsForm.resetForm()},tempUrlImage:"canAddImage",tempLocalImage:"canAddImage"},methods:{...b(_,["updateNews"]),...b(T,["pushMsg"]),canAddImage(){this.tempUrlImage===""&&(this.tempLocalImage===""||!this.tempLocalImage)?this.hasImageFile=!1:this.hasImageFile=!0},addImage(){this.tempUrlImage===""&&this.tempLocalImage===""||(this.tempUrlImage!==""?this.tempNews.image=this.tempUrlImage:this.uploadLocalImage(),this.hasImageUrl=!0,this.tempUrlImage="",this.tempLocalImage="",this.$refs.localImageInput.value="")},getLocalImage(){const n=this.$refs.localImageInput.files[0];this.tempLocalImage=n},uploadLocalImage(){const n=new FormData;n.append("file-to-upload",this.tempLocalImage);const t="https://vue3-course-api.hexschool.io/api/hexvuemm/admin/upload";this.$http.post(t,n).then(d=>{d.data.success&&(this.tempNews.image=d.data.imageUrl,this.$refs.localImageInput.value="")}).catch(()=>{this.pushMsg({style:"danger",title:"圖片上傳失敗",content:"出現系統問題"})})},deleteImg(){this.tempNews.image="",this.hasImageUrl=!1},confirmNews(){if(!this.tempNews.image||this.tempNews.image===""){this.hasImageUrl=!1;return}this.hasImageUrl=!0,this.tempNews.tag=this.tempTag.split(", "),this.tempNews.create_at=Date.now()/1e3,this.tempNews.content=this.tempNews.title,this.updateNews(this.tempNews),this.modal.hide()},closeModal(){this.hasImageUrl=null,this.modal.hide()},submitForm(){this.$refs.updateNewsForm.validate()&&this.confirmNews()}}},A={class:"modal fade",tabindex:"-1",ref:"modal"},P={class:"modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg"},q={class:"modal-content"},B={class:"modal-header bg-primary-400"},E=e("h2",{class:"modal-title fs-5",id:"newsModal"},"新增最新消息",-1),O={class:"modal-body"},z={class:"border-bottom border-gray-400 mb-6"},G=e("label",{for:"newsTitle",class:"form-label me-4 mb-0"},"標題",-1),H={class:"flex-fit"},J=e("label",{for:"newsTag",class:"form-label me-4 mb-0"},"標籤",-1),K={class:"flex-fit"},Q=e("label",{for:"newsAuthor",class:"form-label me-4 mb-0"},"作者",-1),R={class:"flex-fit"},W=e("label",{for:"newsDescription",class:"form-label me-4 mb-0"},"內文",-1),X={class:"flex-fit"},Y={class:"mb-4"},Z=e("div",{class:"d-flex flex-column flex-lg-row align-items-start align-items-lg-center mb-3"},[e("label",{for:"newsImage",class:"form-label me-3 mb-1 mb-lg-0"},"新增圖片"),e("span",{class:"fs-normal-1 bg-primary-300 rounded-pill px-3 py-1 me-3 mb-1 mb-lg-0"},"單一檔案必須小於 1MB"),e("span",{class:"fs-normal-1 bg-primary-300 rounded-pill px-3 py-1 mb-1 mb-lg-"},"僅能上傳 1 張圖片")],-1),ee={class:"d-flex flex-column flex-lg-row align-items-stretch align-items-lg-center mb-1"},te={class:"d-flex align-items-center flex-fit mb-3 mb-lg-0"},se=e("p",{class:"me-3"},"或",-1),le={class:"input-group flex-fit me-3 mb-3 mb-lg-0"},oe=["disabled"],ae=e("p",{class:"error-text position-absolute fs-6 text-danger mb-1"},"圖片 為必填",-1),ne={key:0,style:{width:"100px"}},ie=["src","alt"],de={class:"modal-footer bg-gray-200 justify-content-between"},ce={class:"form-check form-switch"},re=e("label",{class:"form-check-label",for:"newsModalLaunchedSwitch"},[v("上架"),e("span",{class:"d-none d-lg-inline"},"狀態")],-1);function me(n,t,d,k,o,a){const m=g("VField"),p=g("ErrorMsg"),f=g("VForm");return c(),r("div",A,[e("div",P,[e("div",q,[e("div",B,[E,e("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=(...s)=>a.closeModal&&a.closeModal(...s))})]),e("div",O,[i(f,{id:"newsForm",ref:"updateNewsForm"},{default:U(({errors:s})=>[e("div",z,[e("div",{class:u(["d-flex align-items-center mb-8 modalInput",{error:s.標題}])},[G,e("div",H,[i(m,{type:"text",id:"newsTitle",name:"標題",rules:"required",modelValue:o.tempNews.title,"onUpdate:modelValue":t[1]||(t[1]=l=>o.tempNews.title=l),class:"form-control flex-fit py-2 rounded-3 text-black bg-gray-300"},null,8,["modelValue"]),i(p,{name:"標題",class:"error-text position-absolute fs-6 text-danger"})])],2),e("div",{class:u(["d-flex align-items-center mb-8 modalInput",{error:s.標籤}])},[J,e("div",K,[i(m,{type:"text",id:"newsTag",name:"標籤",rules:"required",modelValue:o.tempTag,"onUpdate:modelValue":t[2]||(t[2]=l=>o.tempTag=l),placeholder:"標籤一, 標籤二, 標籤三",class:"form-control flex-fit py-2 rounded-3 text-black bg-gray-300"},null,8,["modelValue"]),i(p,{name:"標籤",class:"error-text position-absolute fs-6 text-danger mb-1"})])],2),e("div",{class:u(["d-flex align-items-center mb-8 modalInput",{error:s.作者}])},[Q,e("div",R,[i(m,{type:"text",id:"newsAuthor",name:"作者",rules:"required",modelValue:o.tempNews.author,"onUpdate:modelValue":t[3]||(t[3]=l=>o.tempNews.author=l),class:"form-control flex-fit py-2 rounded-3 text-black bg-gray-300"},null,8,["modelValue"]),i(p,{name:"作者",class:"error-text position-absolute fs-6 text-danger mb-1"})])],2),e("div",{class:u(["col-12 d-flex align-items-center mb-8 modalInput",{error:s.內文}])},[W,e("div",X,[i(m,{as:"textarea",type:"text",rows:"5",id:"newsDescription",name:"內文",rules:"required",modelValue:o.tempNews.description,"onUpdate:modelValue":t[4]||(t[4]=l=>o.tempNews.description=l),class:"form-control flex-fit py-2 rounded-3 bg-gray-300"},null,8,["modelValue"]),i(p,{name:"內文",class:"error-text position-absolute fs-6 text-danger mb-1"})])],2)]),e("div",Y,[Z,e("div",{class:u(["mb-6 modalInput",{error:o.hasImageUrl===!1}])},[e("div",ee,[e("div",te,[w(e("input",{type:"text",class:"form-control flex-fit py-2 rounded-3 bg-gray-300 me-3",id:"newsImage",placeholder:"貼上圖片網址","onUpdate:modelValue":t[5]||(t[5]=l=>o.tempUrlImage=l)},null,512),[[C,o.tempUrlImage]]),se]),e("div",le,[e("input",{type:"file",class:"form-control bg-gray-300 py-2",accept:"image/png, image/jpeg",placeholder:"上傳電腦中圖片",onChange:t[6]||(t[6]=(...l)=>a.getLocalImage&&a.getLocalImage(...l)),ref:"localImageInput"},null,544)]),e("button",{type:"button",class:"btn btn-gray-800 py-2 px-4",onClick:t[7]||(t[7]=(...l)=>a.addImage&&a.addImage(...l)),disabled:!o.hasImageFile}," 確定 ",8,oe)]),ae],2),o.tempNews.image!==""?(c(),r("div",ne,[e("img",{class:"img-full mb-1",style:{height:"140px"},src:o.tempNews.image,alt:o.tempNews.title},null,8,ie),e("button",{type:"button",class:"d-block btn btn-danger-700 fs-normal-1 w-100",onClick:t[8]||(t[8]=(...l)=>a.deleteImg&&a.deleteImg(...l))}," 刪除 ")])):L("",!0)])]),_:1},512)]),e("div",de,[e("div",ce,[re,w(e("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"newsModalLaunchedSwitch","onUpdate:modelValue":t[9]||(t[9]=s=>o.tempNews.isPublic=s)},null,512),[[V,o.tempNews.isPublic]])]),e("div",null,[e("button",{type:"button",class:"btn btn-outline-gray-800 px-8 px-lg-10 me-2 me-lg-4",onClick:t[10]||(t[10]=(...s)=>a.closeModal&&a.closeModal(...s))}," 取消 "),e("button",{type:"submit",class:"btn btn-gray-800 px-8 px-lg-10",onClick:t[11]||(t[11]=(...s)=>a.submitForm&&a.submitForm(...s))}," 確定 ")])])])])],512)}const pe=I(S,[["render",me]]),ge={data(){return{tempNews:{},isNew:!1,tempDelNews:{},source:"News"}},components:{NewsModal:pe,DeleteModal:D},methods:{...b(_,["getNews","deleteNews","switchPublic"]),openModal(n,t,d){n==="deleteModal"?this.tempDelNews={id:d.id,title:d.title,source:this.source}:(t?this.tempNews={tag:[],image:"",isPublic:!1}:this.tempNews={...d},this.isNew=t),this.$refs[n].showModal()}},computed:{...$(_,["news","newsNum","isLoading"])},created(){this.getNews()}},ue={class:"container-fluid"},he={class:"row justify-content-center pt-6 pt-lg-10"},fe={class:"col-12 col-lg-11"},be={class:"d-flex justify-content-between align-items-center mb-4 mb-lg-10"},_e={class:"fs-3 fw-normal"},we={class:"fs-6"},xe={class:"table-responsive"},ye={class:"admin-table table table-hover align-middle font-sans-tw mb-12"},Ie=e("thead",null,[e("tr",{class:"fs-normal-1"},[e("th",{scope:"col",class:"d-lg-none p-0",style:{width:"50px"}},[e("span",{class:"d-none"},"操作按鈕")]),e("th",{scope:"col",class:"fw-normal text-gray"},"圖片"),e("th",{scope:"col",class:"fw-normal text-gray"},"標題"),e("th",{scope:"col",class:"fw-normal text-center text-gray w-25"},"標籤"),e("th",{scope:"col",class:"fw-normal text-center text-gray d-none d-lg-table-cell"}," 建立日期 "),e("th",{scope:"col",class:"fw-normal text-center text-gray d-none d-lg-table-cell"}," 上架 "),e("th",{scope:"col",class:"d-none d-lg-table-cell fw-normal w-15"},[e("span",{class:"d-none"},"操作按鈕")])])],-1),ve={class:"d-lg-none p-0"},Ne=["onClick"],Me=e("img",{src:M,alt:"編輯"},null,-1),ke=[Me],Ue=["onClick"],Ce=e("img",{src:N,alt:"刪除"},null,-1),Le=[Ce],Ve={scope:"row",class:"d-flex align-items-center justify-content-start"},$e={class:"admin-img me-4"},Fe=["src","alt"],De={class:"d-flex justify-content-center align-items-center flex-wrap"},Te={class:"text-center d-none d-lg-table-cell"},je={class:"d-none d-lg-table-cell"},Se={class:"form-check form-switch d-flex justify-content-center"},Ae=["checked","onClick"],Pe=e("label",{class:"form-check-label d-none",for:"newsLaunchedSwitch"},"上架狀態",-1),qe={class:"text-end d-none d-lg-table-cell"},Be=["onClick"],Ee=e("img",{src:M,alt:"編輯"},null,-1),Oe=[Ee],ze=["onClick"],Ge=e("img",{src:N,alt:"刪除"},null,-1),He=[Ge];function Je(n,t,d,k,o,a){const m=g("LoadingOverlay"),p=g("NewsModal"),f=g("DeleteModal");return c(),r("div",null,[e("div",ue,[e("div",he,[e("div",fe,[e("header",be,[e("h3",_e,[v(" 最新消息 "),e("span",we,"("+h(n.newsNum)+")",1)]),e("button",{type:"button",class:"btn btn-gray-800",onClick:t[0]||(t[0]=s=>a.openModal("newsModal",!0))}," 新增消息 ")]),e("section",null,[e("div",xe,[e("table",ye,[Ie,e("tbody",null,[(c(!0),r(x,null,y(n.news,s=>(c(),r("tr",{key:`news ${s.id}`},[e("td",ve,[e("button",{type:"button",class:"btn border-0 px-1",onClick:l=>a.openModal("newsModal",!1,s)},ke,8,Ne),e("button",{type:"button",class:"btn border-0 px-1",onClick:l=>a.openModal("deleteModal",!1,s)},Le,8,Ue)]),e("td",Ve,[e("div",$e,[e("img",{class:"img-full",src:s.image,alt:s.title},null,8,Fe)])]),e("td",null,h(s.title),1),e("td",null,[e("div",De,[(c(!0),r(x,null,y(s.tag,l=>(c(),r("span",{key:`${s.id}${l}`,class:"badge rounded-pill bg-gray-800 fs-6 fw-normal me-2 mb-2"},h(l),1))),128))])]),e("td",Te,h(n.$filters.date(s.create_at)),1),e("td",je,[e("div",Se,[e("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"newsLaunchedSwitch",checked:s.isPublic,onClick:F(l=>n.switchPublic(s),["prevent"])},null,8,Ae),Pe])]),e("td",qe,[e("button",{type:"button",class:"btn border-0 btn-custom-hover-scale",onClick:l=>a.openModal("newsModal",!1,s)},Oe,8,Be),e("button",{type:"button",class:"btn border-0 btn-custom-hover-scale",onClick:l=>a.openModal("deleteModal",!1,s)},He,8,ze)])]))),128))])])])])])])]),i(m,{active:n.isLoading},null,8,["active"]),i(p,{ref:"newsModal",news:o.tempNews},null,8,["news"]),i(f,{ref:"deleteModal",deleteData:o.tempDelNews},null,8,["deleteData"])])}const Ze=I(ge,[["render",Je]]);export{Ze as default};
