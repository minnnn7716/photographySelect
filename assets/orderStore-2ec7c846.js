import{l as g,p as h,q as c}from"./index-90c93330.js";import{t as u}from"./toastStore-fa35cab5.js";const i=u(),m=g("orderStore",{state:()=>({orders:[],pagination:{},userOrders:[{user:{}}],isLoading:!1}),actions:{getOrders(){const e="https://vue3-course-api.hexschool.io/api/hexvuemm/orders?page=:page";this.isLoading=!0,h.get(e).then(t=>{this.orders=t.data.orders,this.pagination=t.data.pagination,this.isLoading=!1}).catch(()=>{this.isLoading=!1,i.pushMsg({style:"danger",title:"取得訂單失敗",content:"抱歉，出現系統問題，請聯絡我們！"})})},getUserOrders(e){const t="https://vue3-course-api.hexschool.io/api/hexvuemm/orders?page=:page";this.isLoading=!0,h.get(t).then(s=>{this.orders=s.data.orders,this.filterOrder(e),this.isLoading=!1}).catch(()=>{this.isLoading=!1,i.pushMsg({style:"danger",title:"取得訂單失敗",content:"抱歉，出現系統問題，請聯絡我們！"})})},searchOrder(e){this.orders.filter(s=>s.user.email===e).length?c.push(`/order/${e}`):i.pushMsg({style:"danger",title:"查無訂單"})},filterOrder(e){this.userOrders=this.orders.filter(t=>t.user.email===e)},payOrder(e,t){const s=`https://vue3-course-api.hexschool.io/api/hexvuemm/pay/${e}`;this.isLoading=!0,h.post(s).then(a=>{this.isLoading=!1,this.getUserOrders(t),a.data.success?i.pushMsg({style:"success",title:"付款成功"}):i.pushMsg({style:"danger",title:"付款失敗",content:a.data.message})}).catch(()=>{this.isLoading=!1,i.pushMsg({style:"danger",title:"付款失敗",content:"抱歉，出現系統問題，請聯絡我們！"})})},dueDate(e){const t=new Date(e*1e3),s=t.getMonth(),a=t.getDate(),l=[1,3,5,7,8,10,12];let o=s+1,n=a,d=0;l.indexOf(o)===-1?d=30:d=31,a===d?(o+=1,n+=2):n+=1;const r=new Date;return r.setMonth(o-1),r.setDate(n),r.setHours(31),r.setMinutes(59),r.setSeconds(59),r},isCancel(e){const t=new Date().getTime();return this.dueDate(e).getTime()<t}},getters:{orderTotalPrice(){let e=0;return Object.keys(this.orders).length&&(e=this.orders.map(t=>t.total).reduce((t,s)=>t+s,0)),e},orderNum(){let e=0;return Object.keys(this.orders).length&&(e=this.orders.length),e}}});export{m as o};
