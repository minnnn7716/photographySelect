import{m as h,_ as v,r as p,o as c,c as u,a as e,f as s,g as _,n as m,t as b,i as x,s as P,F as U,e as V,x as M,w as k,b as F}from"./index-8558fa27.js";import{a as w}from"./adminProductStore-143ddc0f.js";import{t as N}from"./toastStore-57ead6d4.js";import{m as L}from"./modalMixin-b8f36e48.js";import{R as C}from"./RatingScore-a4a4486e.js";const S={data(){return{modal:"",tempProduct:{},tempUrlImage:"",tempLocalImage:"",hasImageFile:!1,hasImagesUrl:null,overImage:!1}},components:{RatingScore:C},props:{product:{type:Object,default(){return{}}}},mixins:[L],watch:{product(){this.product.id?this.tempProduct=JSON.parse(JSON.stringify(this.product)):(this.tempProduct={...this.product},this.$refs.updateProductForm.resetForm())},tempUrlImage:"canAddImage",tempLocalImage:"canAddImage"},methods:{...h(w,["updateProduct"]),...h(N,["pushMsg"]),canAddImage(){this.tempUrlImage===""&&(this.tempLocalImage===""||!this.tempLocalImage)?this.hasImageFile=!1:this.hasImageFile=!0},addImage(){if(this.tempProduct.imagesUrl||(this.tempProduct.imagesUrl=[]),this.tempProduct.imagesUrl.length>=5){this.overImage=!0,setTimeout(()=>{this.overImage=!1},2e3);return}this.tempUrlImage!==""?this.tempProduct.imagesUrl.push(this.tempUrlImage):this.uploadLocalImage(),this.hasImagesUrl=!0,this.tempUrlImage="",this.tempLocalImage="",this.$refs.localImageInput.value=""},getLocalImage(){const i=this.$refs.localImageInput.files[0];this.tempLocalImage=i},uploadLocalImage(){const i=new FormData;i.append("file-to-upload",this.tempLocalImage);const l="https://vue3-course-api.hexschool.io/api/hexvuemm/admin/upload";this.$http.post(l,i).then(g=>{g.data.success&&(this.tempProduct.imagesUrl.push(g.data.imageUrl),this.$refs.localImageInput.value="")}).catch(()=>{this.pushMsg({style:"danger",title:"圖片上傳失敗",content:"出現系統問題"})})},deleteImg(i){this.tempProduct.imagesUrl.splice(i,1),this.tempProduct.imagesUrl.length||(this.hasImagesUrl=!1)},confirmProduct(){if(!this.tempProduct.imagesUrl||!this.tempProduct.imagesUrl.length){this.hasImagesUrl=!1;return}this.hasImagesUrl=!0;const i=this.tempProduct.imagesUrl[0];this.tempProduct.imageUrl=i,this.updateProduct(this.tempProduct),this.modal.hide()},closeModal(){this.hasImagesUrl=null,this.modal.hide()},submitForm(){this.$refs.updateProductForm.validate()&&this.confirmProduct()}}},q={class:"modal fade",id:"productModal",tabindex:"-1",ref:"modal"},A={class:"modal-dialog modal-dialog-scrollable modal-xl modal-dialog-centered"},B={class:"modal-content"},D={class:"modal-header bg-primary-400"},R=e("h2",{class:"modal-title fs-5",id:"productModal"},"新增商品",-1),j={class:"modal-body"},E={class:"container"},O={class:"row border-bottom border-gray-400 mb-6"},T=e("label",{for:"type",class:"form-label me-4 mb-0"},"分類",-1),J={class:"flex-fit"},z=e("option",{selected:"",disabled:""},"商品分類",-1),G=e("option",{value:"人物"},"人物",-1),H=e("option",{value:"食物"},"食物",-1),K=e("option",{value:"植物"},"植物",-1),Q=e("option",{value:"動物"},"動物",-1),W=e("option",{value:"景致"},"景致",-1),X=e("option",{value:"複合"},"複合",-1),Y=e("label",{for:"title",class:"form-label me-4 mb-0"},"標題",-1),Z={class:"flex-fit"},$=e("label",{for:"author",class:"form-label me-4 mb-0"},"作者",-1),ee={class:"flex-fit"},te=e("label",{for:"originPrice",class:"form-label me-4 mb-0"},"定價",-1),le={class:"flex-fit"},oe=e("label",{for:"salePrice",class:"form-label me-4 mb-0"},"售價",-1),se={class:"flex-fit"},ae=e("label",{for:"unit",class:"form-label me-4 mb-0"},"單位",-1),re={class:"flex-fit"},me=e("label",{for:"totalNum",class:"form-label me-4 mb-0"},"總數",-1),ie={class:"flex-fit"},ne={class:"col-6 col-lg-2 d-flex align-items-center mb-6 mb-lg-8"},de=e("p",{class:"me-4"},"銷量",-1),ce={class:"col-6 col-lg-2 d-flex align-items-center mb-6 mb-lg-8"},ue=e("p",{class:"me-4"},"剩餘",-1),pe={class:"col-12 col-lg-4 d-flex align-items-center mb-6 mb-lg-8"},ge=e("p",{class:"me-4"},"評價",-1),fe={class:"ms-1"},be=e("label",{for:"format",class:"form-label me-4 mb-0"},"規格",-1),he={class:"flex-fit"},_e=e("label",{for:"content",class:"form-label me-4 mb-0"},"內文",-1),xe={class:"flex-fit"},ye={class:"mb-4"},Ie=e("div",{class:"d-flex flex-column flex-lg-row align-items-start align-items-lg-center mb-3"},[e("label",{for:"image",class:"form-label mb-0 me-3 mb-1 mb-lg-0"},"新增圖片"),e("span",{class:"fs-normal-1 bg-primary-300 rounded-pill px-3 py-1 me-3 mb-1 mb-lg-0"},"單一檔案必須小於 1MB"),e("span",{class:"fs-normal-1 bg-primary-300 rounded-pill px-3 py-1 mb-1 mb-lg-0"},"最多 5 張圖")],-1),ve={class:"d-flex flex-column flex-lg-row align-items-stretch align-items-lg-center mb-1"},Pe={class:"d-flex align-items-center flex-fit mb-3 mb-lg-0"},Ue=e("p",{class:"me-3"},"或",-1),Ve={class:"input-group flex-fit me-3 mb-3 mb-lg-0"},Me=["disabled"],ke={class:"error-text position-absolute fs-normal-1 fs-lg-6 text-danger mb-1"},Fe={key:0},we={key:1},Ne={class:"list-unstyled d-flex"},Le=e("li",null,null,-1),Ce=["src","alt"],Se=["onClick"],qe={class:"modal-footer bg-gray-200 justify-content-between"},Ae={class:"form-check form-switch"},Be=e("label",{class:"form-check-label",for:"productModalLaunchedSwitch"},[F("上架"),e("span",{class:"d-none d-lg-inline"},"狀態")],-1);function De(i,l,g,Re,t,r){const n=p("VField"),d=p("ErrorMsg"),y=p("RatingScore"),I=p("VForm");return c(),u("div",q,[e("div",A,[e("div",B,[e("div",D,[R,e("button",{type:"button",class:"btn-close",onClick:l[0]||(l[0]=(...a)=>r.closeModal&&r.closeModal(...a))})]),e("div",j,[e("div",E,[s(I,{ref:"updateProductForm"},{default:_(({errors:a})=>[e("div",O,[e("div",{class:m(["col-12 col-lg-4 d-flex align-items-center mb-6 mb-lg-8 modalInput",{error:a.分類}])},[T,e("div",J,[s(n,{as:"select",id:"type",name:"分類",rules:"required",modelValue:t.tempProduct.category,"onUpdate:modelValue":l[1]||(l[1]=o=>t.tempProduct.category=o),class:"form-select py-2 rounded-3 bg-gray-300"},{default:_(()=>[z,G,H,K,Q,W,X]),_:1},8,["modelValue"]),s(d,{name:"分類",class:"error-text position-absolute fs-normal-1 fs-lg-6 text-danger"})])],2),e("div",{class:m(["col-12 col-lg-4 d-flex align-items-center mb-6 mb-lg-8 modalInput",{error:a.標題}])},[Y,e("div",Z,[s(n,{type:"text",name:"標題",id:"title",rules:"required",modelValue:t.tempProduct.title,"onUpdate:modelValue":l[2]||(l[2]=o=>t.tempProduct.title=o),class:"form-control py-2 rounded-3 bg-gray-300 text-black"},null,8,["modelValue"]),s(d,{name:"標題",class:"error-text position-absolute fs-normal-1 fs-lg-6 text-danger mb-1"})])],2),e("div",{class:m(["col-12 col-lg-4 d-flex align-items-center mb-6 mb-lg-8 modalInput",{error:a.作者}])},[$,e("div",ee,[s(n,{type:"text",name:"作者",id:"author",rules:"required",modelValue:t.tempProduct.author,"onUpdate:modelValue":l[3]||(l[3]=o=>t.tempProduct.author=o),class:"form-control py-2 rounded-3 bg-gray-300"},null,8,["modelValue"]),s(d,{name:"作者",class:"error-text position-absolute fs-normal-1 fs-lg-6 text-danger mb-1"})])],2),e("div",{class:m(["col-12 col-lg-4 d-flex align-items-center mb-6 mb-lg-8 modalInput",{error:a.定價}])},[te,e("div",le,[s(n,{type:"number",min:"0",id:"originPrice",name:"定價",rules:"required",modelValue:t.tempProduct.origin_price,"onUpdate:modelValue":l[4]||(l[4]=o=>t.tempProduct.origin_price=o),class:"form-control py-2 rounded-3 bg-gray-300"},null,8,["modelValue"]),s(d,{name:"定價",class:"error-text position-absolute fs-normal-1 fs-lg-6 text-danger mb-1"})])],2),e("div",{class:m(["col-12 col-lg-4 d-flex align-items-center mb-6 mb-lg-8 modalInput",{error:a.售價}])},[oe,e("div",se,[s(n,{type:"number",min:"0",id:"salePrice",name:"售價",rules:"required",modelValue:t.tempProduct.price,"onUpdate:modelValue":l[5]||(l[5]=o=>t.tempProduct.price=o),class:"form-control py-2 rounded-3 bg-gray-300"},null,8,["modelValue"]),s(d,{name:"售價",class:"error-text position-absolute fs-normal-1 fs-lg-6 text-danger mb-1"})])],2),e("div",{class:m(["col-12 col-lg-4 d-flex align-items-center mb-6 mb-lg-8 modalInput",{error:a.單位}])},[ae,e("div",re,[s(n,{type:"text",id:"unit",name:"單位",rules:"required",modelValue:t.tempProduct.unit,"onUpdate:modelValue":l[6]||(l[6]=o=>t.tempProduct.unit=o),class:"form-control flex-fit py-2 rounded-3 bg-gray-300"},null,8,["modelValue"]),s(d,{name:"單位",class:"error-text position-absolute fs-normal-1 fs-lg-6 text-danger mb-1"})])],2),e("div",{class:m(["col-12 col-lg-4 d-flex align-items-center mb-6 mb-lg-8 modalInput",{error:a.總數}])},[me,e("div",ie,[s(n,{type:"number",min:"1",id:"totalNum",name:"總數",rules:"required",modelValue:t.tempProduct.totalNum,"onUpdate:modelValue":l[7]||(l[7]=o=>t.tempProduct.totalNum=o),class:"form-control flex-fit py-2 rounded-3 bg-gray-300"},null,8,["modelValue"]),s(d,{name:"總數",class:"error-text position-absolute fs-normal-1 fs-lg-6 text-danger mb-1"})])],2),e("div",ne,[de,e("p",null,b(t.tempProduct.soldNum),1)]),e("div",ce,[ue,e("p",null,b(t.tempProduct.totalNum-t.tempProduct.soldNum),1)]),e("div",pe,[ge,s(y,{rate:t.tempProduct.rate,rateNum:t.tempProduct.rateNum},null,8,["rate","rateNum"]),e("p",fe,"/ "+b(t.tempProduct.rateNum)+" 則",1)]),e("div",{class:m(["col-12 d-flex align-items-center mb-6 mb-lg-8 modalInput",{error:a.規格}])},[be,e("div",he,[s(n,{type:"text",name:"規格",id:"format",class:"form-control flex-fit py-2 rounded-3 bg-gray-300",modelValue:t.tempProduct.format,"onUpdate:modelValue":l[8]||(l[8]=o=>t.tempProduct.format=o),rules:"required"},null,8,["modelValue"]),s(d,{name:"規格",class:"error-text position-absolute fs-normal-1 fs-lg-6 text-danger mb-1"})])],2),e("div",{class:m(["col-12 d-flex align-items-center mb-6 mb-lg-8 modalInput",{error:a.內文}])},[_e,e("div",xe,[s(n,{as:"textarea",type:"text",name:"內文",id:"content",class:"form-control flex-fit py-2 rounded-3 bg-gray-300",rows:"5",modelValue:t.tempProduct.content,"onUpdate:modelValue":l[9]||(l[9]=o=>t.tempProduct.content=o),rules:"required"},null,8,["modelValue"]),s(d,{name:"內文",class:"error-text position-absolute fs-normal-1 fs-lg-6 text-danger mb-1"})])],2)]),e("div",ye,[Ie,e("div",{class:m(["mb-8 modalInput",{error:t.hasImagesUrl===!1||t.overImage}])},[e("div",ve,[e("div",Pe,[x(e("input",{type:"text",class:"form-control flex-fit py-2 rounded-3 bg-gray-300 me-3",id:"image",placeholder:"貼上圖片網址","onUpdate:modelValue":l[10]||(l[10]=o=>t.tempUrlImage=o)},null,512),[[P,t.tempUrlImage]]),Ue]),e("div",Ve,[e("input",{type:"file",class:"form-control bg-gray-300 py-2",accept:"image/png, image/jpeg",placeholder:"上傳電腦中圖片",onChange:l[11]||(l[11]=(...o)=>r.getLocalImage&&r.getLocalImage(...o)),ref:"localImageInput"},null,544)]),e("button",{type:"button",class:"btn btn-gray-800 py-2 px-4",onClick:l[12]||(l[12]=(...o)=>r.addImage&&r.addImage(...o)),disabled:!t.hasImageFile}," 確定新增 ",8,Me)]),e("p",ke,[t.hasImagesUrl===!1?(c(),u("span",Fe,"圖片 為必填")):(c(),u("span",we,"最多五張圖片"))])],2),e("ul",Ne,[Le,(c(!0),u(U,null,V(t.tempProduct.imagesUrl,(o,f)=>(c(),u("li",{key:`圖片 ${f}`,class:m({"me-3":f!==t.tempProduct.imagesUrl.length-1})},[e("img",{class:"img-full mb-1",style:{height:"140px",width:"100px"},src:o,alt:`${t.tempProduct.title} 圖片`},null,8,Ce),e("button",{type:"button",class:"d-block btn btn-danger-700 fs-normal-1 w-100",onClick:je=>r.deleteImg(f)}," 刪除 ",8,Se)],2))),128))])])]),_:1},512)])]),e("div",qe,[e("div",Ae,[Be,x(e("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"productModalLaunchedSwitch","onUpdate:modelValue":l[13]||(l[13]=a=>t.tempProduct.is_enabled=a)},null,512),[[M,t.tempProduct.is_enabled]])]),e("div",null,[e("button",{type:"button",class:"btn btn-outline-gray-800 px-8 px-lg-10 me-2 me-lg-4",onClick:l[14]||(l[14]=(...a)=>r.closeModal&&r.closeModal(...a))}," 取消 "),e("button",{onClick:l[15]||(l[15]=k((...a)=>r.submitForm&&r.submitForm(...a),["prevent"])),type:"submit",class:"btn btn-gray-800 px-8 px-lg-10"}," 確定 ")])])])])],512)}const Ge=v(S,[["render",De]]);export{Ge as P};
