import{l as r,p as o,q as h}from"./index-90c93330.js";import{t as u}from"./toastStore-fa35cab5.js";const p=u(),g=r("productStore",{state:()=>({products:[],singleProduct:{},pagination:{},isLoading:!1}),actions:{getProducts(t){const s=`https://vue3-course-api.hexschool.io/api/hexvuemm/products?page=${t}`;this.isLoading=!0,o.get(s).then(a=>{this.products=a.data.products,this.pagination=a.data.pagination,this.isLoading=!1,t&&(window.scrollTo({top:0,behavior:"smooth"}),h.push(`/products?page=${t}`))}).catch(()=>{this.isLoading=!1,p.pushMsg({style:"danger",title:"取得商品失敗",content:"抱歉，出現系統問題，請聯絡我們！"})})},getSingleProduct(t){const s=`https://vue3-course-api.hexschool.io/api/hexvuemm/product/${t}`;this.isLoading=!0,o.get(s).then(a=>{this.isLoading=!1,a.data.success?this.singleProduct=a.data.product:h.push("/notfound")}).catch(a=>{a.request.status===404&&(this.isLoading=!1,p.pushMsg({style:"danger",title:"取得商品失敗",content:"抱歉，出現系統問題，請聯絡我們！"}))})},routerPush(t){h.push(`/products/${t}`)}},getters:{availableNum(){return this.singleProduct.totalNum-this.singleProduct.soldNum||0}}}),e=u(),f=r("cartStore",{state:()=>({cartsData:{},orderId:"",couponData:{},couponCode:"",step:1,isPaid:!1,isLoading:!1}),actions:{nothingInCart(){this.step==="pay"||this.step==="final"||this.cartsData.carts.length||(e.pushMsg({style:"danger",title:"購物車內無商品",content:"將於 2 秒後自動為您跳轉至商品頁"}),setTimeout(()=>{h.push("/products")},"2000"))},getCart(){const t="https://vue3-course-api.hexschool.io/api/hexvuemm/cart";this.isLoading=!0,o.get(t).then(s=>{this.cartsData=s.data.data,this.getTotalNum(),this.getCoupon(),this.isLoading=!1}).catch(()=>{e.pushMsg({style:"danger",title:"購物車取得失敗"}),h.push("/notfound")})},getTotalNum(){let t=0;this.cartsData.carts.forEach(s=>{t+=s.qty}),this.cartsData.totalNum=t,this.cartsData.itemsNum=this.cartsData.carts.length},addCart(t,s){const a="https://vue3-course-api.hexschool.io/api/hexvuemm/cart",i={product_id:t,qty:s};this.isLoading=!0,o.post(a,{data:i}).then(c=>{this.isLoading=!1,c.data.success?(this.getCart(),e.pushMsg({style:"success",title:"成功加入購物車"})):e.pushMsg({style:"danger",title:"加入購物車失敗",content:c.data.message})}).catch(()=>{e.pushMsg({style:"danger",title:"加入購物車失敗",content:"抱歉，出現系統問題，請聯絡我們！"})})},buyNow(t,s){this.addCart(t,s),h.push("/cart")},updatedCart(t,s,a){const i=`https://vue3-course-api.hexschool.io/api/hexvuemm/cart/${t}`,c={product_id:s,qty:a};this.isLoading=!0,o.put(i,{data:c}).then(n=>{this.isLoading=!1,n.data.success?(this.getCart(),e.pushMsg({style:"success",title:"成功更新購物車"})):e.pushMsg({style:"danger",title:"更新購物車失敗",content:n.data.message})}).catch(()=>{e.pushMsg({style:"danger",title:"更新購物車失敗",content:"抱歉，出現系統問題，請聯絡我們！"})})},deleteCart(t){const s=`https://vue3-course-api.hexschool.io/api/hexvuemm/cart/${t}`;o.delete(s).then(a=>{this.isLoading=!1,a.data.success?(this.getCart(),e.pushMsg({style:"primary",title:"成功刪除商品"})):e.pushMsg({style:"danger",title:"刪除商品失敗",content:a.data.message})}).catch(()=>{e.pushMsg({style:"danger",title:"刪除商品失敗",content:"抱歉，出現系統問題，請聯絡我們！"})})},deleteAllCart(){const t="https://vue3-course-api.hexschool.io/api/hexvuemm/carts";this.isLoading=!0,o.delete(t).then(s=>{this.isLoading=!1,s.data.success?(this.getCart(),e.pushMsg({style:"primary",title:"成功刪除全部購物車"})):e.pushMsg({style:"danger",title:"刪除全部購物車失敗",content:s.data.message})}).catch(()=>{e.pushMsg({style:"danger",title:"刪除全部購物車失敗",content:"抱歉，出現系統問題，請聯絡我們！"})})},nextStep(t){t==="cart"?(this.step=1,h.push("/checkout")):this.step===1?this.step=2:this.step===2&&(this.step="final")},prevStep(){this.step===2?this.step=1:this.step===1&&(h.push("/cart"),this.step=1)},changeStep(t){this.step==="pay"||this.step==="final"||(this.step=t,t==="cart"&&(this.step=1,h.push("/cart")))},laterPay(){this.step="final"},payOrder(){const t=`https://vue3-course-api.hexschool.io/api/hexvuemm/pay/${this.orderId}`;this.isLoading=!0,o.post(t).then(s=>{this.step="final",this.isPaid=!0,this.isLoading=!1,s.data.success?e.pushMsg({style:"success",title:"付款成功"}):e.pushMsg({style:"danger",title:"付款失敗",content:s.data.message})}).catch(()=>{e.pushMsg({style:"danger",title:"付款失敗",content:"抱歉，出現系統問題，請聯絡我們！"})})},orderCart(t,s){const a="https://vue3-course-api.hexschool.io/api/hexvuemm/order";this.isLoading=!0,o.post(a,{data:t}).then(i=>{this.orderId=i.data.orderId,this.isLoading=!1,this.step=s,i.data.success?(this.getCart(),e.pushMsg({style:"success",title:"成功訂購商品"})):e.pushMsg({style:"danger",title:"商品訂購失敗",content:i.data.message})}).catch(()=>{e.pushMsg({style:"danger",title:"商品訂購失敗",content:"抱歉，出現系統問題，請聯絡我們！"})})},useCoupon(t){const s="https://vue3-course-api.hexschool.io/api/hexvuemm/coupon";this.isLoading=!0,o.post(s,{data:{code:t}}).then(a=>{this.isLoading=!1,a.data.success?(this.getCart(),e.pushMsg({style:"success",title:"成功使用折價券"})):e.pushMsg({style:"danger",title:"使用折價券失敗",content:a.data.message})}).catch(()=>{e.pushMsg({style:"danger",title:"使用折價券失敗",content:"抱歉，出現系統問題，請聯絡我們！"})})},getCoupon(){const t=this.cartsData.carts;let s={},a="";if(t.length){const i=t[0];Object.prototype.hasOwnProperty.call(i,"coupon")&&(s={...i.coupon},a=s.code)}this.couponData=s,this.couponCode=a}},getters:{discountPrice(){return this.cartsData.total-Math.floor(this.cartsData.final_total)}}});export{f as c,g as p};
