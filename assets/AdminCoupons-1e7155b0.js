import{m as g,_ as x,r as u,o as _,c as h,a as e,f as a,g as w,n as m,i as M,x as k,b as C,d as V,t as p,F as S,e as $}from"./index-90c93330.js";import{c as f,D as F,_ as y}from"./icon-trashcan-5c6df785.js";import{m as L}from"./modalMixin-b8f36e48.js";import{_ as D}from"./icon-edit-2eb35b7f.js";import"./adminProductStore-af6c843c.js";import"./toastStore-fa35cab5.js";const I={data(){return{modal:"",tempCoupon:{},tempStartDate:"",tempDueDate:""}},props:{coupon:{type:Object,default(){return{}}}},mixins:[L],watch:{coupon(){this.tempCoupon={...this.coupon},this.coupon.id?(this.translateDate(this.tempCoupon.start_date,"tempStartDate"),this.translateDate(this.tempCoupon.due_date,"tempDueDate")):(this.$refs.updateCouponForm.resetForm(),this.tempStartDate="",this.tempDueDate="")}},methods:{...g(f,["updatedCoupon"]),confirmCoupon(){const o=this.tempCoupon.is_enabled?1:0;this.tempCoupon.is_enabled=o,this.tempCoupon.start_date=Math.round(new Date(this.tempStartDate)/1e3),this.tempCoupon.due_date=Math.round(new Date(this.tempDueDate)/1e3),this.updatedCoupon(this.tempCoupon),this.modal.hide()},translateDate(o,t){let d="";o==="now"?d=new Date(Date.now()).toISOString().slice(0,10):d=new Date(o*1e3).toISOString().slice(0,10),this[t]=d},translateDateFormat(o){const t=o.split("-");return[t[0],t[2],t[1]].join("-")},getDate(o,t){o.split("").indexOf("-")!==-1&&(this[t]=new Date(o).toISOString().slice(0,10))}}},O={class:"modal fade",tabindex:"-1",ref:"modal"},j={class:"modal-dialog modal-dialog-centered"},E={class:"modal-content"},U=e("div",{class:"modal-header bg-primary-400"},[e("h2",{class:"modal-title fs-5",id:"couponModal"},"新增折價券"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1),q={class:"modal-body"},A=e("label",{for:"title",class:"form-label me-4 mb-0 w-20"},"活動名稱",-1),N={class:"flex-fit"},B=e("label",{for:"code",class:"form-label me-4 mb-0 w-20"},"優惠碼",-1),z={class:"flex-fit"},T=e("label",{for:"discount",class:"form-label me-4 mb-0 w-20"},"折扣",-1),G={class:"flex-fit"},H={class:"d-flex align-items-center flex-fit"},J=e("p",{class:"ms-4"},"%",-1),K=e("label",{for:"startDate",class:"form-label me-4 mb-0 w-20"},"起始日",-1),P={class:"flex-fit"},Q=e("label",{for:"dueDate",class:"form-label me-4 mb-0 w-20"},"到期日",-1),R={class:"flex-fit"},W={class:"modal-footer bg-gray-200 justify-content-between"},X={class:"form-check form-switch"},Y=e("label",{class:"form-check-label",for:"couponModalLaunchedSwitch"},[C("啟用"),e("span",{class:"d-none d-lg-inline"},"狀態")],-1),Z=e("div",null,[e("button",{type:"button",class:"btn btn-outline-gray-800 px-8 px-lg-10 me-2 me-lg-4","data-bs-dismiss":"modal"}," 取消 "),e("button",{form:"couponForm",type:"submit",class:"btn btn-gray-800 px-8 px-lg-10"}," 確定 ")],-1);function ee(o,t,d,v,l,c){const i=u("VField"),r=u("ErrorMsg"),b=u("VForm");return _(),h("div",O,[e("div",j,[e("div",E,[U,e("div",q,[a(b,{onSubmit:c.confirmCoupon,id:"couponForm",ref:"updateCouponForm"},{default:w(({errors:s})=>[e("div",{class:m(["d-flex align-items-center mb-8 modalInput",{error:s.活動名稱}])},[A,e("div",N,[a(i,{type:"text",id:"title",name:"活動名稱",rules:"required",modelValue:l.tempCoupon.title,"onUpdate:modelValue":t[0]||(t[0]=n=>l.tempCoupon.title=n),class:"form-control flex-fit py-2 rounded-3 text-black bg-gray-300"},null,8,["modelValue"]),a(r,{name:"活動名稱",class:"error-text position-absolute fs-6 text-danger mb-1"})])],2),e("div",{class:m(["d-flex align-items-center mb-8 modalInput",{error:s.優惠碼}])},[B,e("div",z,[a(i,{type:"text",id:"code",name:"優惠碼",rules:"required",modelValue:l.tempCoupon.code,"onUpdate:modelValue":t[1]||(t[1]=n=>l.tempCoupon.code=n),class:"form-control flex-fit py-2 rounded-3 text-black bg-gray-300"},null,8,["modelValue"]),a(r,{name:"優惠碼",class:"error-text position-absolute fs-6 text-danger mb-1"})])],2),e("div",{class:m(["d-flex align-items-center mb-8 modalInput",{error:s.折扣}])},[T,e("div",G,[e("div",H,[a(i,{type:"number",id:"discount",name:"折扣",rules:"required|minValue:0|maxValue:100",modelValue:l.tempCoupon.percent,"onUpdate:modelValue":t[2]||(t[2]=n=>l.tempCoupon.percent=n),modelModifiers:{number:!0},placeholder:"請輸入 0 - 100 之間的數字",class:"form-control py-2 rounded-3 text-black bg-gray-300"},null,8,["modelValue"]),J]),a(r,{name:"折扣",class:"error-text position-absolute fs-6 text-danger mb-1"})])],2),e("div",{class:m(["d-flex align-items-center mb-8 modalInput",{error:s.起始日}])},[K,e("div",P,[a(i,{type:"date",id:"startDate",name:"起始日",rules:"required",modelValue:l.tempStartDate,"onUpdate:modelValue":t[3]||(t[3]=n=>l.tempStartDate=n),onChange:t[4]||(t[4]=n=>c.getDate(n.target.value,"tempStartDate")),class:"form-control flex-fit py-2 rounded-3 text-black bg-gray-300"},null,8,["modelValue"]),a(r,{name:"起始日",class:"error-text position-absolute fs-6 text-danger mb-1"})])],2),e("div",{class:m(["d-flex align-items-center mb-8 modalInput",{error:s.到期日}])},[Q,e("div",R,[a(i,{type:"date",id:"dueDate",name:"到期日",rules:"required",modelValue:l.tempDueDate,"onUpdate:modelValue":t[5]||(t[5]=n=>l.tempDueDate=n),class:"form-control flex-fit py-2 rounded-3 text-black bg-gray-300"},null,8,["modelValue"]),a(r,{name:"到期日",class:"error-text position-absolute fs-6 text-danger mb-1"})])],2)]),_:1},8,["onSubmit"])]),e("div",W,[e("div",X,[Y,M(e("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"couponModalLaunchedSwitch","onUpdate:modelValue":t[6]||(t[6]=s=>l.tempCoupon.is_enabled=s)},null,512),[[k,l.tempCoupon.is_enabled]])]),Z])])])],512)}const te=x(I,[["render",ee]]),oe={data(){return{tempCoupon:{},isNew:!1,tempDelCoupon:{},source:"Coupon"}},components:{DeleteModal:F,CouponModal:te},methods:{...g(f,["getCoupons","updatedCoupon","deleteCoupon"]),openModal(o,t,d){o==="deleteModal"?this.tempDelCoupon={id:d.id,title:d.title,source:this.source}:(t?this.tempCoupon={}:this.tempCoupon={...d},this.isNew=t),this.$refs[o].showModal()},switchEnable(o){this.tempCoupon={...o},this.tempCoupon.is_enabled=!this.tempCoupon.is_enabled,this.tempCoupon.is_enabled=this.tempCoupon.is_enabled?1:0,this.updatedCoupon(this.tempCoupon)}},computed:{...V(f,["coupons","isLoading"])},created(){this.getCoupons()}},se={class:"container-fluid"},ne={class:"row justify-content-center pt-6 pt-lg-10"},le={class:"col-12 col-lg-11"},ae={class:"d-flex justify-content-between align-items-center mb-4 mb-lg-10"},de={class:"fs-3 fw-normal"},ce={class:"fs-6"},ie={class:"table-responsive"},re={class:"admin-table table table-hover align-middle font-sans-tw mb-12"},pe=e("thead",null,[e("tr",{class:"fs-normal-1"},[e("th",{scope:"col",class:"d-lg-none p-0",style:{width:"50px"}},[e("span",{class:"d-none"},"操作按鈕")]),e("th",{scope:"col",class:"fw-normal text-gray"},"活動"),e("th",{scope:"col",class:"fw-normal text-center text-gray"},"折價碼"),e("th",{scope:"col",class:"fw-normal text-center text-gray"},"折扣"),e("th",{scope:"col",class:"fw-normal text-center text-gray d-none d-lg-table-cell"}," 上架狀態 "),e("th",{scope:"col",class:"fw-normal text-center text-gray d-none d-lg-table-cell"}," 起始日 "),e("th",{scope:"col",class:"fw-normal text-center text-gray"},"到期日"),e("th",{scope:"col",class:"d-none d-lg-table-cell fw-normal w-15"},[e("span",{class:"d-none"},"操作按鈕")])])],-1),ue={class:"d-lg-none px-0 py-1"},me=["onClick"],_e=e("img",{src:D,alt:"編輯"},null,-1),he=[_e],be=["onClick"],fe=e("img",{src:y,alt:"刪除"},null,-1),ge=[fe],xe={class:"text-center"},Ce={class:"text-center"},ye={class:"d-none d-lg-table-cell"},De={class:"form-check form-switch d-flex justify-content-center"},ve=["checked","onClick"],we=e("label",{class:"form-check-label d-none",for:"`couponLaunchedSwitch`"},"上架狀態",-1),Me={class:"text-center d-none d-lg-table-cell"},ke={class:"text-center"},Ve={class:"text-end d-none d-lg-table-cell"},Se=["onClick"],$e=e("img",{src:D,alt:"編輯"},null,-1),Fe=[$e],Le=["onClick"],Ie=e("img",{src:y,alt:"刪除"},null,-1),Oe=[Ie];function je(o,t,d,v,l,c){const i=u("LoadingOverlay"),r=u("CouponModal"),b=u("DeleteModal");return _(),h("div",null,[e("div",se,[e("div",ne,[e("div",le,[e("header",ae,[e("h3",de,[C(" 折價券 "),e("span",ce,"("+p(o.coupons.length)+")",1)]),e("button",{type:"button",class:"btn btn-gray-800",onClick:t[0]||(t[0]=s=>c.openModal("couponModal",!0))}," 新增折價券 ")]),e("section",null,[e("div",ie,[e("table",re,[pe,e("tbody",null,[(_(!0),h(S,null,$(o.coupons,s=>(_(),h("tr",{key:`coupon ${s.id}`},[e("td",ue,[e("button",{type:"button",class:"btn border-0 px-1",onClick:n=>c.openModal("couponModal",!1,s)},he,8,me),e("button",{type:"button",class:"btn border-0 px-1",onClick:n=>c.openModal("deleteModal",!1,s)},ge,8,be)]),e("td",null,p(s.title),1),e("td",xe,p(s.code),1),e("td",Ce,p(s.percent/10)+" 折",1),e("td",ye,[e("div",De,[e("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"`couponLaunchedSwitch`",checked:s.is_enabled,onClick:n=>c.switchEnable(s)},null,8,ve),we])]),e("td",Me,p(o.$filters.date(s.start_date)),1),e("td",ke,p(o.$filters.date(s.due_date)),1),e("td",Ve,[e("button",{type:"button",class:"btn border-0 btn-custom-hover-scale",onClick:n=>c.openModal("couponModal",!1,s)},Fe,8,Se),e("button",{type:"button",class:"btn border-0 btn-custom-hover-scale",onClick:n=>c.openModal("deleteModal",!1,s)},Oe,8,Le)])]))),128))])])])])])])]),a(i,{active:o.isLoading},null,8,["active"]),a(r,{ref:"couponModal",coupon:l.tempCoupon},null,8,["coupon"]),a(b,{ref:"deleteModal",deleteData:l.tempDelCoupon},null,8,["deleteData"])])}const ze=x(oe,[["render",je]]);export{ze as default};
