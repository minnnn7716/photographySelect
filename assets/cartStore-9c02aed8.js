import{l as r,p as o,q as h}from"./index-75005144.js";import{t as p}from"./toastStore-24da0ea0.js";const n=p(),g=r("productStore",{state:()=>({products:[],singleProduct:{},pagination:{},isLoading:!1}),actions:{getProducts(t){const s=`https://vue3-course-api.hexschool.io/api/hexvuemm/products?page=${t}`;this.isLoading=!0,o.get(s).then(e=>{this.products=e.data.products,this.pagination=e.data.pagination,this.isLoading=!1,t&&(window.scrollTo({top:0,behavior:"smooth"}),h.push(`/products?page=${t}`))}).catch(e=>{e.request.status===404&&(this.isLoading=!1,n.pushMsg({style:"danger",title:"取得商品失敗",content:"抱歉，出現系統問題，請聯絡我們！"}))})},getSingleProduct(t){const s=`https://vue3-course-api.hexschool.io/api/hexvuemm/product/${t}`;this.isLoading=!0,o.get(s).then(e=>{this.isLoading=!1,e.data.success?this.singleProduct=e.data.product:h.push("/notfound")}).catch(e=>{e.request.status===404&&(this.isLoading=!1,n.pushMsg({style:"danger",title:"取得商品失敗",content:"抱歉，出現系統問題，請聯絡我們！"}))})},routerPush(t){h.push(`/products/${t}`)}},getters:{availableNum(){return this.singleProduct.totalNum-this.singleProduct.soldNum||0}}}),a=p(),f=r("cartStore",{state:()=>({cartsData:{},orderId:"",couponData:{},couponCode:"",step:1,isPaid:!1,isLoading:!1}),actions:{nothingInCart(){this.step==="pay"||this.step==="final"||this.cartsData.carts.length||(a.pushMsg({style:"danger",title:"購物車內無商品",content:"將於 2 秒後自動為您跳轉至商品頁"}),setTimeout(()=>{h.push("/products")},"2000"))},getCart(){const t="https://vue3-course-api.hexschool.io/api/hexvuemm/cart";this.isLoading=!0,o.get(t).then(s=>{this.cartsData=s.data.data,this.getTotalNum(),this.getCoupon(),this.isLoading=!1}).catch(s=>{s.request.status===404&&(a.pushMsg({style:"danger",title:"購物車取得失敗"}),h.push("/notfound"))})},getTotalNum(){let t=0;this.cartsData.carts.forEach(s=>{t+=s.qty}),this.cartsData.totalNum=t,this.cartsData.itemsNum=this.cartsData.carts.length},addCart(t,s){const e="https://vue3-course-api.hexschool.io/api/hexvuemm/cart",i={product_id:t,qty:s};this.isLoading=!0,o.post(e,{data:i}).then(c=>{this.isLoading=!1,c.data.success?(this.getCart(),a.pushMsg({style:"success",title:"成功加入購物車"})):a.pushMsg({style:"danger",title:"加入購物車失敗",content:c.data.message})}).catch(c=>{c.request.status===404&&a.pushMsg({style:"danger",title:"加入購物車失敗",content:"抱歉，出現系統問題，請聯絡我們！"})})},buyNow(t,s){this.addCart(t,s),h.push("/cart")},updatedCart(t,s,e){const i=`https://vue3-course-api.hexschool.io/api/hexvuemm/cart/${t}`,c={product_id:s,qty:e};this.isLoading=!0,o.put(i,{data:c}).then(u=>{this.isLoading=!1,u.data.success?(this.getCart(),a.pushMsg({style:"success",title:"成功更新購物車"})):a.pushMsg({style:"danger",title:"更新購物車失敗",content:u.data.message})}).catch(u=>{u.request.status===404&&a.pushMsg({style:"danger",title:"更新購物車失敗",content:"抱歉，出現系統問題，請聯絡我們！"})})},deleteCart(t){const s=`https://vue3-course-api.hexschool.io/api/hexvuemm/cart/${t}`;o.delete(s).then(e=>{this.isLoading=!1,e.data.success?(this.getCart(),a.pushMsg({style:"primary",title:"成功刪除商品"})):a.pushMsg({style:"danger",title:"刪除商品失敗",content:e.data.message})}).catch(e=>{e.request.status===404&&a.pushMsg({style:"danger",title:"刪除商品失敗",content:"抱歉，出現系統問題，請聯絡我們！"})})},deleteAllCart(){const t="https://vue3-course-api.hexschool.io/api/hexvuemm/carts";this.isLoading=!0,o.delete(t).then(s=>{this.isLoading=!1,s.data.success?(this.getCart(),a.pushMsg({style:"primary",title:"成功刪除全部購物車"})):a.pushMsg({style:"danger",title:"刪除全部購物車失敗",content:s.data.message})}).catch(s=>{s.request.status===404&&a.pushMsg({style:"danger",title:"刪除全部購物車失敗",content:"抱歉，出現系統問題，請聯絡我們！"})})},nextStep(t){t==="cart"?(this.step=1,h.push("/checkout")):this.step===1?this.step=2:this.step===2&&(this.step="final")},prevStep(){this.step===2?this.step=1:this.step===1&&(h.push("/cart"),this.step=1)},changeStep(t){this.step==="pay"||this.step==="final"||(this.step=t,t==="cart"&&(this.step=1,h.push("/cart")))},laterPay(){this.step="final"},payOrder(){const t=`https://vue3-course-api.hexschool.io/api/hexvuemm/pay/${this.orderId}`;this.isLoading=!0,o.post(t).then(s=>{this.step="final",this.isPaid=!0,this.isLoading=!1,s.data.success?a.pushMsg({style:"success",title:"付款成功"}):a.pushMsg({style:"danger",title:"付款失敗",content:s.data.message})}).catch(s=>{s.request.status===404&&a.pushMsg({style:"danger",title:"付款失敗",content:"抱歉，出現系統問題，請聯絡我們！"})})},orderCart(t,s){const e="https://vue3-course-api.hexschool.io/api/hexvuemm/order";this.isLoading=!0,o.post(e,{data:t}).then(i=>{this.orderId=i.data.orderId,this.isLoading=!1,this.step=s,i.data.success?(this.getCart(),a.pushMsg({style:"success",title:"成功訂購商品"})):a.pushMsg({style:"danger",title:"商品訂購失敗",content:i.data.message})}).catch(i=>{i.request.status===404&&a.pushMsg({style:"danger",title:"商品訂購失敗",content:"抱歉，出現系統問題，請聯絡我們！"})})},useCoupon(t){const s="https://vue3-course-api.hexschool.io/api/hexvuemm/coupon";this.isLoading=!0,o.post(s,{data:{code:t}}).then(e=>{this.isLoading=!1,e.data.success?(this.getCart(),a.pushMsg({style:"success",title:"成功使用折價券"})):a.pushMsg({style:"danger",title:"使用折價券失敗",content:e.data.message})}).catch(e=>{e.request.status===404&&a.pushMsg({style:"danger",title:"使用折價券失敗",content:"抱歉，出現系統問題，請聯絡我們！"})})},getCoupon(){const t=this.cartsData.carts;let s={},e="";if(t.length){const i=t[0];Object.prototype.hasOwnProperty.call(i,"coupon")&&(s={...i.coupon},e=s.code)}this.couponData=s,this.couponCode=e}},getters:{discountPrice(){return this.cartsData.total-Math.floor(this.cartsData.final_total)}}});export{f as c,g as p};
